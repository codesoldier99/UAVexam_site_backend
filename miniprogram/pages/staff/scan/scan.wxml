<view class="scan-container">
  <!-- Header Section -->
  <view class="header-section">
    <view class="staff-info">
      <view class="avatar">{{staffInfo.name ? staffInfo.name.charAt(0) : 'ğŸ‘¨â€ğŸ’¼'}}</view>
      <view class="info">
        <view class="name">{{staffInfo.name || 'Staff'}}</view>
        <view class="role">{{staffInfo.role || 'Examiner'}} | {{staffInfo.id || 'ID001'}}</view>
      </view>
    </view>
    <view class="logout-btn" bindtap="logout">
      <text class="logout-icon">ğŸšª</text>
    </view>
  </view>

  <!-- Scan Section -->
  <view class="scan-section">
    <view class="scan-title">æ‰«æè€ƒç”ŸäºŒç»´ç </view>
    <view class="scan-subtitle">Scan Student QR Code</view>
    
    <!-- Camera View -->
    <view class="camera-container">
      <camera 
        class="camera" 
        device-position="back" 
        flash="off" 
        binderror="onCameraError"
        bindstop="onCameraStop"
        bindinitialized="onCameraReady"
        wx:if="{{cameraAuthorized}}"
      ></camera>
      
      <!-- Camera Authorization -->
      <view class="camera-auth" wx:else>
        <view class="auth-icon">ğŸ“·</view>
        <view class="auth-text">éœ€è¦ç›¸æœºæƒé™</view>
        <button class="auth-btn" bindtap="requestCameraAuth">æˆæƒç›¸æœº</button>
      </view>
      
      <!-- Scan Frame -->
      <view class="scan-frame" wx:if="{{cameraAuthorized}}">
        <view class="frame-corner tl"></view>
        <view class="frame-corner tr"></view>
        <view class="frame-corner bl"></view>
        <view class="frame-corner br"></view>
        <view class="scan-line"></view>
      </view>
      
      <!-- Scan Button -->
      <view class="scan-controls" wx:if="{{cameraAuthorized}}">
        <button class="scan-btn {{scanning ? 'scanning' : ''}}" bindtap="startScan" disabled="{{scanning || processing}}">
          <view class="scan-icon">{{scanning ? 'â¸ï¸' : 'ğŸ“±'}}</view>
          <text class="scan-text">{{scanning ? 'æ‰«æä¸­...' : 'å¼€å§‹æ‰«æ'}}</text>
        </button>
      </view>
    </view>
  </view>

  <!-- Manual Input Section -->
  <view class="manual-section">
    <view class="manual-title">æ‰‹åŠ¨è¾“å…¥</view>
    <view class="input-container">
      <input 
        class="qr-input" 
        type="text" 
        placeholder="è¾“å…¥äºŒç»´ç å†…å®¹æˆ–è€ƒç”ŸID (å¦‚: C001, EXAM_C001_20250108)"
        value="{{manualInput}}"
        bindinput="onManualInput"
      />
      <button class="manual-btn" bindtap="handleManualInput" disabled="{{!manualInput.trim() || processing}}">
        {{processing ? 'å¤„ç†ä¸­...' : 'ç¡®è®¤'}}
      </button>
    </view>
    
    <!-- Quick Test Buttons -->
    <view class="quick-test">
      <view class="test-title">å¿«é€Ÿæµ‹è¯•:</view>
      <view class="test-buttons">
        <button class="test-btn" bindtap="handleManualInput" data-code="C001">å¼ ä¸‰ (C001)</button>
        <button class="test-btn" bindtap="handleManualInput" data-code="C002">æå›› (C002)</button>
        <button class="test-btn" bindtap="handleManualInput" data-code="C003">ç‹äº” (C003)</button>
      </view>
    </view>
  </view>

  <!-- Recent Scans -->
  <view class="recent-section" wx:if="{{recentScans.length > 0}}">
    <view class="section-title">
      <text>æœ€è¿‘æ‰«æ</text>
      <view class="refresh-btn" bindtap="loadRecentScans">ğŸ”„</view>
    </view>
    <view class="recent-list">
      <view class="recent-item" wx:for="{{recentScans}}" wx:key="id" bindtap="viewScanDetail" data-scan="{{item}}">
        <view class="scan-info">
          <view class="candidate-name">{{item.candidateName}}</view>
          <view class="scan-time">{{item.scanTime}}</view>
        </view>
        <view class="scan-status {{item.status}}">
          <text class="status-icon">{{item.statusIcon}}</text>
          <text class="status-text">{{item.statusText}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Empty State -->
  <view class="empty-state" wx:if="{{recentScans.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-text">æš‚æ— æ‰«æè®°å½•</view>
    <view class="empty-subtitle">å¼€å§‹æ‰«æè€ƒç”ŸäºŒç»´ç è¿›è¡Œç­¾åˆ°</view>
  </view>

  <!-- Statistics -->
  <view class="stats-section">
    <view class="stat-item">
      <view class="stat-number">{{todayStats.scanned}}</view>
      <view class="stat-label">ä»Šæ—¥æ‰«æ</view>
    </view>
    <view class="stat-item">
      <view class="stat-number">{{todayStats.checkedIn}}</view>
      <view class="stat-label">æˆåŠŸç­¾åˆ°</view>
    </view>
    <view class="stat-item">
      <view class="stat-number">{{todayStats.failed}}</view>
      <view class="stat-label">å¤±è´¥æ¬¡æ•°</view>
    </view>
  </view>
</view>

<!-- Scan Result Modal -->
<view class="modal-overlay" wx:if="{{showResult}}" bindtap="closeResult">
  <view class="result-modal" catchtap="">
    <view class="result-header">
      <view class="result-icon {{resultData.success ? 'success' : 'error'}}">
        {{resultData.success ? 'âœ…' : 'âŒ'}}
      </view>
      <view class="result-title">
        {{resultData.success ? 'ç­¾åˆ°æˆåŠŸ' : 'ç­¾åˆ°å¤±è´¥'}}
      </view>
    </view>
    
    <view class="result-content" wx:if="{{resultData.candidateInfo}}">
      <view class="info-row">
        <text class="label">å§“å:</text>
        <text class="value">{{resultData.candidateInfo.name}}</text>
      </view>
      <view class="info-row">
        <text class="label">è€ƒè¯•:</text>
        <text class="value">{{resultData.candidateInfo.examName}}</text>
      </view>
      <view class="info-row">
        <text class="label">æ—¶é—´:</text>
        <text class="value">{{resultData.candidateInfo.examTime}}</text>
      </view>
      <view class="info-row">
        <text class="label">åœ°ç‚¹:</text>
        <text class="value">{{resultData.candidateInfo.venue}}</text>
      </view>
      <view class="info-row" wx:if="{{resultData.candidateInfo.checkInTime}}">
        <text class="label">ç­¾åˆ°æ—¶é—´:</text>
        <text class="value">{{resultData.candidateInfo.checkInTime}}</text>
      </view>
    </view>
    
    <view class="result-message">
      {{resultData.message}}
    </view>
    
    <view class="result-actions">
      <button class="action-btn secondary" bindtap="closeResult">å…³é—­</button>
      <button class="action-btn primary" bindtap="continueScan" wx:if="{{resultData.success}}">ç»§ç»­æ‰«æ</button>
    </view>
  </view>
</view>

<!-- Loading Overlay -->
<view class="loading-overlay" wx:if="{{processing}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <view class="loading-text">å¤„ç†ä¸­...</view>
  </view>
</view>
