<!--miniprogram/pages/candidate/profile/profile.wxml-->
<view class="container">
  <!-- Loading Overlay -->
  <view class="loading-overlay" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
  </view>

  <!-- Hero Section -->
  <view class="hero-section">
    <view class="hero-bg"></view>
    <view class="hero-content">
      <!-- Avatar -->
      <view class="avatar-container">
        <image class="avatar" src="{{candidateInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="status-dot" style="background-color: {{getStatusColor(candidateInfo.status)}}"></view>
      </view>
      
      <!-- Basic Info -->
      <view class="user-info">
        <view class="user-name">{{candidateInfo.name || 'è€ƒç”Ÿ'}}</view>
        <view class="user-id">ID: {{candidateInfo.id_number || candidateInfo.studentId || '--'}}</view>
        <view class="user-status">
          <text class="status-label">{{getStatusLabel(candidateInfo.status)}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Quick Stats -->
  <view class="quick-stats">
    <view class="stat-item" bindtap="goToSchedule">
      <view class="stat-icon">ğŸ“…</view>
      <view class="stat-info">
        <view class="stat-number">{{examStats.totalExams || 0}}</view>
        <view class="stat-label">è€ƒè¯•å®‰æ’</view>
      </view>
    </view>
    <view class="stat-item">
      <view class="stat-icon">âœ…</view>
      <view class="stat-info">
        <view class="stat-number">{{examStats.completedExams || 0}}</view>
        <view class="stat-label">å·²å®Œæˆ</view>
      </view>
    </view>
    <view class="stat-item">
      <view class="stat-icon">ğŸ“Š</view>
      <view class="stat-info">
        <view class="stat-number">{{examStats.passRate || 0}}%</view>
        <view class="stat-label">é€šè¿‡ç‡</view>
      </view>
    </view>
  </view>

  <!-- Personal Information Card -->
  <view class="info-card">
    <view class="card-header">
      <view class="card-title">
        <view class="title-icon">ğŸ‘¤</view>
        <text class="title-text">ä¸ªäººä¿¡æ¯</text>
      </view>
      <button class="edit-btn" bindtap="toggleEdit" wx:if="{{!isEditing}}">
        <text class="edit-text">ç¼–è¾‘</text>
      </button>
      <view class="edit-actions" wx:else>
        <button class="save-btn" bindtap="saveProfile">ä¿å­˜</button>
        <button class="cancel-btn" bindtap="cancelEdit">å–æ¶ˆ</button>
      </view>
    </view>
    
    <view class="card-content">
      <view class="info-item">
        <view class="item-label">å§“å</view>
        <input 
          wx:if="{{isEditing}}"
          class="item-input" 
          value="{{candidateInfo.name}}" 
          data-field="name"
          bindinput="onInputChange"
          placeholder="è¯·è¾“å…¥å§“å"
        />
        <view wx:else class="item-value">{{candidateInfo.name || '--'}}</view>
      </view>

      <view class="info-item">
        <view class="item-label">èº«ä»½è¯å·</view>
        <input 
          wx:if="{{isEditing}}"
          class="item-input" 
          value="{{candidateInfo.id_number || candidateInfo.idCard}}" 
          data-field="id_number"
          bindinput="onInputChange"
          placeholder="è¯·è¾“å…¥èº«ä»½è¯å·"
        />
        <view wx:else class="item-value">{{candidateInfo.id_number || candidateInfo.idCard || '--'}}</view>
      </view>

      <view class="info-item">
        <view class="item-label">æ‰‹æœºå·</view>
        <input 
          wx:if="{{isEditing}}"
          class="item-input" 
          value="{{candidateInfo.phone}}" 
          data-field="phone"
          bindinput="onInputChange"
          placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
        />
        <view wx:else class="item-value">{{candidateInfo.phone || '--'}}</view>
      </view>

      <view class="info-item">
        <view class="item-label">é‚®ç®±</view>
        <input 
          wx:if="{{isEditing}}"
          class="item-input" 
          value="{{candidateInfo.email}}" 
          data-field="email"
          bindinput="onInputChange"
          placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
        />
        <view wx:else class="item-value">{{candidateInfo.email || '--'}}</view>
      </view>
    </view>
  </view>

  <!-- Institution Card -->
  <view class="info-card">
    <view class="card-header">
      <view class="card-title">
        <view class="title-icon">ğŸ¢</view>
        <text class="title-text">æœºæ„ä¿¡æ¯</text>
      </view>
    </view>
    
    <view class="card-content">
      <view class="info-item">
        <view class="item-label">æ‰€å±æœºæ„</view>
        <view class="item-value">{{candidateInfo.institution_name || candidateInfo.department || '--'}}</view>
      </view>
      
      <view class="info-item">
        <view class="item-label">è€ƒè¯•äº§å“</view>
        <view class="item-value">{{candidateInfo.exam_product_name || '--'}}</view>
      </view>
      
      <view class="info-item">
        <view class="item-label">æŠ¥åæ—¶é—´</view>
        <view class="item-value">{{formatDate(candidateInfo.created_at) || '--'}}</view>
      </view>
    </view>
  </view>

  <!-- Quick Actions -->
  <view class="action-card">
    <view class="card-header">
      <view class="card-title">
        <view class="title-icon">âš¡</view>
        <text class="title-text">å¿«æ·æ“ä½œ</text>
      </view>
    </view>
    
    <view class="action-list">
      <view class="action-item" bindtap="goToQRCode">
        <view class="action-icon">ğŸ”²</view>
        <view class="action-content">
          <view class="action-title">æˆ‘çš„äºŒç»´ç </view>
          <view class="action-desc">æŸ¥çœ‹ç­¾åˆ°äºŒç»´ç </view>
        </view>
        <view class="action-arrow">â€º</view>
      </view>
      
      <view class="action-item" bindtap="goToSchedule">
        <view class="action-icon">ğŸ“‹</view>
        <view class="action-content">
          <view class="action-title">è€ƒè¯•å®‰æ’</view>
          <view class="action-desc">æŸ¥çœ‹è€ƒè¯•æ—¶é—´è¡¨</view>
        </view>
        <view class="action-arrow">â€º</view>
      </view>
      
      <view class="action-item" bindtap="viewCheckinHistory">
        <view class="action-icon">ğŸ“</view>
        <view class="action-content">
          <view class="action-title">ç­¾åˆ°è®°å½•</view>
          <view class="action-desc">æŸ¥çœ‹å†å²ç­¾åˆ°</view>
        </view>
        <view class="action-arrow">â€º</view>
      </view>
      
      <view class="action-item" bindtap="contactService">
        <view class="action-icon">ğŸ’¬</view>
        <view class="action-content">
          <view class="action-title">è”ç³»å®¢æœ</view>
          <view class="action-desc">è·å–å¸®åŠ©æ”¯æŒ</view>
        </view>
        <view class="action-arrow">â€º</view>
      </view>
    </view>
  </view>

  <!-- Settings -->
  <view class="settings-card">
    <view class="setting-item" bindtap="onRefresh">
      <view class="setting-icon">ğŸ”„</view>
      <view class="setting-text">åˆ·æ–°æ•°æ®</view>
      <view class="setting-arrow">â€º</view>
    </view>
    
    <view class="setting-item logout-item" bindtap="logout">
      <view class="setting-icon">ğŸšª</view>
      <view class="setting-text">é€€å‡ºç™»å½•</view>
      <view class="setting-arrow">â€º</view>
    </view>
  </view>

  <!-- Status Modal -->
  <view class="modal-overlay" wx:if="{{showStatusModal}}" bindtap="hideStatus">
    <view class="status-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">å½“å‰çŠ¶æ€</text>
        <view class="close-btn" bindtap="hideStatus">Ã—</view>
      </view>
      <view class="modal-content">
        <view class="current-status">
          <view class="status-indicator" style="background-color: {{getStatusColor(candidateInfo.status)}}"></view>
          <text class="status-name">{{getStatusLabel(candidateInfo.status)}}</text>
        </view>
        <view class="status-description">
          <text wx:if="{{candidateInfo.status === 'registered'}}">æ‚¨å·²æˆåŠŸæ³¨å†Œè€ƒè¯•ã€‚</text>
          <text wx:elif="{{candidateInfo.status === 'confirmed'}}">æ‚¨çš„è€ƒè¯•æ³¨å†Œå·²ç¡®è®¤ã€‚</text>
          <text wx:elif="{{candidateInfo.status === 'checked_in'}}">æ‚¨å·²å®Œæˆè€ƒè¯•ç­¾åˆ°ã€‚</text>
          <text wx:else>æ‚¨å·²å®Œæˆè€ƒè¯•ã€‚</text>
        </view>
      </view>
    </view>
  </view>
</view>
