<!--miniprogram/pages/candidate/profile/profile.wxml-->
<view class="container">
  <!-- Loading Overlay -->
  <view class="loading-overlay" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
  </view>

  <!-- Profile Header -->
  <view class="profile-header">
    <view class="header-bg"></view>
    <view class="profile-content">
      <view class="avatar-section">
        <view class="avatar-wrapper" bindtap="chooseAvatar" wx:if="{{isEditing}}">
          <image class="avatar" src="{{candidateInfo.avatar}}" mode="aspectFill"></image>
          <view class="avatar-overlay">
            <image class="camera-icon" src="/images/icons/camera.png"></image>
          </view>
        </view>
        <image wx:else class="avatar" src="{{candidateInfo.avatar}}" mode="aspectFill"></image>
        
        <view class="status-badge" bindtap="showStatus">
          <text class="status-text" style="color: {{getStatusInfo(candidateInfo.status).color}}">
            {{getStatusInfo(candidateInfo.status).label}}
          </text>
        </view>
      </view>
      
      <view class="basic-info">
        <view class="name">{{candidateInfo.name}}</view>
        <view class="student-id">ID: {{candidateInfo.studentId}}</view>
        <view class="department">{{candidateInfo.department}} - {{candidateInfo.major}}</view>
      </view>
    </view>
  </view>

  <!-- Statistics Cards -->
  <view class="stats-section">
    <view class="stats-card" bindtap="goToSchedule">
      <view class="stat-number">{{examStats.totalExams}}</view>
      <view class="stat-label">Total Exams</view>
    </view>
    <view class="stats-card">
      <view class="stat-number">{{examStats.completedExams}}</view>
      <view class="stat-label">Completed</view>
    </view>
    <view class="stats-card">
      <view class="stat-number">{{examStats.upcomingExams}}</view>
      <view class="stat-label">Upcoming</view>
    </view>
    <view class="stats-card">
      <view class="stat-number">{{examStats.passRate}}%</view>
      <view class="stat-label">Pass Rate</view>
    </view>
  </view>

  <!-- Profile Information -->
  <view class="info-section">
    <view class="section-header">
      <text class="section-title">Personal Information</text>
      <button class="edit-btn" bindtap="toggleEdit" wx:if="{{!isEditing}}">
        <image class="edit-icon" src="/images/icons/edit.png"></image>
        Edit
      </button>
      <view class="edit-actions" wx:else>
        <button class="save-btn" bindtap="saveProfile">Save</button>
        <button class="cancel-btn" bindtap="cancelEdit">Cancel</button>
      </view>
    </view>

    <view class="info-form">
      <view class="form-group">
        <text class="label">Full Name</text>
        <input 
          wx:if="{{isEditing}}"
          class="input-field" 
          value="{{candidateInfo.name}}" 
          data-field="name"
          bindinput="onInputChange"
          placeholder="Enter your full name"
        />
        <text wx:else class="field-value">{{candidateInfo.name}}</text>
      </view>

      <view class="form-group">
        <text class="label">ID Card</text>
        <input 
          wx:if="{{isEditing}}"
          class="input-field" 
          value="{{candidateInfo.idCard}}" 
          data-field="idCard"
          bindinput="onInputChange"
          placeholder="Enter ID card number"
        />
        <text wx:else class="field-value">{{candidateInfo.idCard}}</text>
      </view>

      <view class="form-group">
        <text class="label">Phone</text>
        <input 
          wx:if="{{isEditing}}"
          class="input-field" 
          value="{{candidateInfo.phone}}" 
          data-field="phone"
          bindinput="onInputChange"
          placeholder="Enter phone number"
        />
        <text wx:else class="field-value">{{candidateInfo.phone}}</text>
      </view>

      <view class="form-group">
        <text class="label">Email</text>
        <input 
          wx:if="{{isEditing}}"
          class="input-field" 
          value="{{candidateInfo.email}}" 
          data-field="email"
          bindinput="onInputChange"
          placeholder="Enter email address"
        />
        <text wx:else class="field-value">{{candidateInfo.email}}</text>
      </view>

      <view class="form-group">
        <text class="label">Department</text>
        <input 
          wx:if="{{isEditing}}"
          class="input-field" 
          value="{{candidateInfo.department}}" 
          data-field="department"
          bindinput="onInputChange"
          placeholder="Enter department"
        />
        <text wx:else class="field-value">{{candidateInfo.department}}</text>
      </view>

      <view class="form-group">
        <text class="label">Major</text>
        <input 
          wx:if="{{isEditing}}"
          class="input-field" 
          value="{{candidateInfo.major}}" 
          data-field="major"
          bindinput="onInputChange"
          placeholder="Enter major"
        />
        <text wx:else class="field-value">{{candidateInfo.major}}</text>
      </view>

      <view class="form-group">
        <text class="label">Grade</text>
        <input 
          wx:if="{{isEditing}}"
          class="input-field" 
          value="{{candidateInfo.grade}}" 
          data-field="grade"
          bindinput="onInputChange"
          placeholder="Enter grade"
        />
        <text wx:else class="field-value">{{candidateInfo.grade}}</text>
      </view>
    </view>
  </view>

  <!-- Quick Actions -->
  <view class="actions-section">
    <view class="action-item" bindtap="goToQRCode">
      <image class="action-icon" src="/images/icons/qrcode.png"></image>
      <text class="action-text">My QR Code</text>
      <image class="arrow-icon" src="/images/icons/arrow-right.png"></image>
    </view>
    
    <view class="action-item" bindtap="goToSchedule">
      <image class="action-icon" src="/images/icons/schedule.png"></image>
      <text class="action-text">Exam Schedule</text>
      <image class="arrow-icon" src="/images/icons/arrow-right.png"></image>
    </view>
    
    <view class="action-item" bindtap="onRefresh">
      <image class="action-icon" src="/images/icons/refresh.png"></image>
      <text class="action-text">Refresh Data</text>
      <image class="arrow-icon" src="/images/icons/arrow-right.png"></image>
    </view>
  </view>

  <!-- Logout Button -->
  <view class="logout-section">
    <button class="logout-btn" bindtap="logout">
      <image class="logout-icon" src="/images/icons/logout.png"></image>
      Logout
    </button>
  </view>

  <!-- Status Modal -->
  <view class="modal-overlay" wx:if="{{showStatusModal}}" bindtap="hideStatus">
    <view class="status-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">Current Status</text>
        <view class="close-btn" bindtap="hideStatus">Ã—</view>
      </view>
      <view class="modal-content">
        <view class="current-status">
          <view class="status-indicator" style="background-color: {{getStatusInfo(candidateInfo.status).color}}"></view>
          <text class="status-name">{{getStatusInfo(candidateInfo.status).label}}</text>
        </view>
        <view class="status-description">
          <text wx:if="{{candidateInfo.status === 'registered'}}">You have successfully registered for the exam.</text>
          <text wx:elif="{{candidateInfo.status === 'confirmed'}}">Your exam registration has been confirmed.</text>
          <text wx:elif="{{candidateInfo.status === 'checked_in'}}">You have checked in for the exam.</text>
          <text wx:else>You have completed the exam.</text>
        </view>
      </view>
    </view>
  </view>
</view>